---
id: 20260203-081833-azl3d7
timestamp: "2026-02-03T08:18:33Z"
packages:
    - shipyard
changeType: minor
metadata:
    author: claude
    pr: none
---

Add self-upgrade command with automatic installation detection

## Overview

Implements `shipyard upgrade` command that automatically detects how shipyard was installed and uses the appropriate upgrade strategy to update to the latest version.

## Features

- **Automatic detection** of installation method (Homebrew, npm, Go install, script/manual, Docker)
- **Interactive confirmation** with animated spinners for visual feedback
- **Dry-run mode** (`--dry-run`) to preview upgrade without executing
- **Force upgrade** (`--force`) to reinstall even if already on latest version
- **Non-interactive mode** (`--yes`) to skip confirmation prompts
- **GitHub API integration** with rate limit handling and optional authentication
- **SHA256 checksum verification** for script installations
- **Atomic binary replacement** to prevent corruption during upgrades

## Implementation

### New Components

- `internal/upgrade/types.go` - Core types for upgrade system
- `internal/upgrade/detector.go` - Installation method detection
- `internal/upgrade/github.go` - GitHub API client for release fetching
- `internal/upgrade/upgrader.go` - Upgrade strategies for each installation method
- `internal/commands/upgrade.go` - Main upgrade command

### Upgrade Strategies

- **HomebrewUpgrader**: Uses `brew upgrade natonathan/tap/shipyard`
- **NPMUpgrader**: Uses `npm update -g shipyard-cli`
- **GoUpgrader**: Uses `go install github.com/NatoNathan/shipyard/cmd/shipyard@{version}`
- **ScriptUpgrader**: Downloads binary, verifies checksum, performs atomic replacement
- **Docker**: Detects but guides user to pull new image manually

### Error Handling

- Added `UpgradeError` and `NetworkError` types to `internal/errors/errors.go`
- Clear error messages with actionable recovery suggestions
- Graceful handling of rate limits, network failures, and permission issues

### Testing

- **56 test functions** across 4 test files
- Unit tests for detector, GitHub client, and upgraders
- Contract tests for CLI interface and flags
- Mock HTTP servers for GitHub API testing
- Comprehensive edge case coverage

## Usage

```bash
# Upgrade with confirmation
shipyard upgrade

# Upgrade without confirmation
shipyard upgrade --yes

# Show what would change
shipyard upgrade --dry-run

# Force reinstall
shipyard upgrade --force
```

## Documentation

- Updated README.md with "Upgrading Shipyard" section
- Command help text with examples
- Installation method detection documented
